{"version":3,"sources":["assets/js/map_section_click_module.js"],"names":["mapSectionClickModule","calendarEvents","map","on","e","features","queryRenderedFeatures","point","layers","length","tempPoint","coordinates","lngLat","lng","lat","type","getSource","setData","flyTo","center","zoom","bearing","speed","curve","easing","t","$","getJSON","data","document","querySelector","innerHTML","place_name","split","properties","contractor","capitalizeFirstLetter","value","FID","className","todaysMonth","moment","month","todaysYear","year","ajax","url","dataType","success","response","day","next_pickups","trash","next_pickup","format","recycling","bulk","console","log","window"],"mappings":"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","file":"map_section_click_module.2ebe88a8.js","sourceRoot":"..","sourcesContent":["var mapSectionClickModule = (function(calendarEvents){\n  map.on('click', function (e) {\n    // console.log(e);\n    var features = map.queryRenderedFeatures(e.point, { layers: ['advance-fill'] });\n    if (!features.length) {\n      features = map.queryRenderedFeatures(e.point, { layers: ['gfl-fill'] });\n      // console.log(features);\n    }\n    if (features.length) {\n      let tempPoint = {\n        coordinates: [e.lngLat.lng, e.lngLat.lat],\n        type: \"Point\"\n      };\n      // console.log(tempPoint);\n      map.getSource('single-point').setData(tempPoint);\n      map.flyTo({\n          center: [e.lngLat.lng, e.lngLat.lat],\n          zoom: 14,\n          bearing: 0,\n\n          // These options control the flight curve, making it move\n          // slowly and zoom out almost completely before starting\n          // to pan.\n          speed: 2, // make the flying slow\n          curve: 1, // change the speed at which it zooms out\n\n          // This can be any easing function: it takes a number between\n          // 0 and 1 and returns another number between 0 and 1.\n          easing: function (t) {\n              return t;\n          }\n      });\n      //=================== street sweeping ========================\n      // $.getJSON('https://gis.detroitmi.gov/arcgis/rest/services/DPW/Weeks/MapServer/0/query?where=&text=&objectIds=&time=&geometry='+e.lngLat.lng+'%2C'+e.lngLat.lat+'&geometryType=esriGeometryPoint&inSR=4326&spatialRel=esriSpatialRelWithin&relationParam=&outFields=*&returnGeometry=true&returnTrueCurves=false&maxAllowableOffset=&geometryPrecision=&outSR=&returnIdsOnly=false&returnCountOnly=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&returnDistinctValues=false&resultOffset=&resultRecordCount=&f=pjson' , function( data ) {\n      //   console.log(data.features[0].attributes.VISIBLE);\n      //   console.log();\n      //   console.log(moment('2017-05-01').add(((data.features[0].attributes.VISIBLE * 7)-7), 'days').format('MMM,DD'));\n      //   console.log(moment('2017-05-01').add(((data.features[0].attributes.VISIBLE * 7)-3), 'days').format('MMM,DD'));\n      //   document.querySelector('.info-container > .district').innerHTML = '<span>Street Sweeping</span> ' + moment('2017-05-01').add(((data.features[0].attributes.VISIBLE * 7)-7), 'days').format('MMM DD') + ' - ' + moment('2017-05-01').add(((data.features[0].attributes.VISIBLE * 7)-3), 'days').format('MMM DD');\n      // });\n      //=========================== street name ====================\n      $.getJSON('https://api.mapbox.com/geocoding/v5/mapbox.places/'+e.lngLat.lng+'%2C'+e.lngLat.lat+'.json?access_token=pk.eyJ1Ijoic2x1c2Fyc2tpZGRldHJvaXRtaSIsImEiOiJjaXZsNXlwcXQwYnY5MnlsYml4NTJ2Mno4In0.8wKUnlMPIlxq-eWH0d10-Q', function( data ) {\n        // console.log(data.features[0].place_name);\n        document.querySelector('.info-container > .street-name').innerHTML = data.features[0].place_name.split(',')[0];\n      });\n      //======================== pick up services ==================\n      if(features[0].properties.contractor == 'advance'){\n        document.querySelector('.info-container > .provider').innerHTML = '<span>Provider:</span> <a href=\"https://www.advanceddisposal.com/mi/detroit/detroit-residential-collection\" target=\"_new\">' + capitalizeFirstLetter(features[0].properties.contractor) + '</a> - <a href=\"tel:844-233-8764\">(844) 233-8764</a>';\n      }else{\n        document.querySelector('.info-container > .provider').innerHTML = '<span>Provider:</span> <a href=\"http://gflusa.com/residential/detroit/\" target=\"_new\">' + capitalizeFirstLetter(features[0].properties.contractor) + '</a> - <a href=\"tel:844-464-3587\">(844) 464-3587</a>';\n      }\n      \n      document.querySelector('.info-container > input[name=\"route-id\"]').value = features[0].properties.FID;\n      document.querySelector('.service-check > #garbage-checkbox').value = features[0].properties.FID;\n      document.querySelector('.service-check > #recycle-checkbox').value = features[0].properties.FID;\n      document.querySelector('.service-check > #bulk-yard-checkbox').value = features[0].properties.FID;\n      document.querySelector('.info-container > input[name=\"lng\"]').value = e.lngLat.lng;\n      document.querySelector('.info-container > input[name=\"lat\"]').value = e.lngLat.lat;\n      (document.querySelector('#info').className === 'active') ? 0 : document.querySelector('#info').className = 'active';\n      let todaysMonth =  moment().month() + 1;\n      let todaysYear = moment().year();\n      $.ajax({\n        // TODO change this to https\n        url : 'https://apis.detroitmi.gov/waste_schedule/details/' + features[0].properties.FID + '/year/' + todaysYear + '/month/' + todaysMonth + '/',\n        type : 'GET',\n        dataType:'json',\n        success : function(response) {\n          // console.log(response);\n          document.querySelector('.info-container > .garbage').innerHTML = '<span>Garbage:</span> ' + capitalizeFirstLetter(features[0].properties.day) + ' - ' + moment(response.next_pickups.trash.next_pickup).format('MMM Do');\n          document.querySelector('.info-container > .recycle').innerHTML = '<span>Curbside Recycle:</span> ' + capitalizeFirstLetter(features[0].properties.day) + ' - ' + moment(response.next_pickups.recycling.next_pickup).format('MMM Do');\n          document.querySelector('.info-container > .bulk').innerHTML = '<span>Bulk:</span> ' + capitalizeFirstLetter(features[0].properties.day) + ' - ' + moment(response.next_pickups.bulk.next_pickup).format('MMM Do');\n          document.querySelector('.info-container > .yard').innerHTML = '<span>Yard Waste:</span> ' + capitalizeFirstLetter(features[0].properties.day) + ' - ' + moment(response.next_pickups['yard waste'].next_pickup).format('MMM Do');\n        }\n      });\n    }else{\n      console.log('No data on point');\n    }\n    return;\n  });\n})(window, calendarEvents);\n"]}